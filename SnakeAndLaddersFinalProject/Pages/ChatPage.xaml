<Page x:Class="SnakeAndLaddersFinalProject.Pages.ChatPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:language="clr-namespace:SnakeAndLaddersFinalProject.Properties.Langs"
      mc:Ignorable="d"
      d:DesignHeight="768" d:DesignWidth="1152"
      Title="ChatPage">

    <!-- ✅ Recursos -->
    <Page.Resources>
        <!-- Si ya tienes uno en App.xaml, quita esta línea -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="*"/>
            <!-- Mensajes -->
            <RowDefinition Height="Auto"/>
            <!-- Input -->
            <RowDefinition Height="Auto"/>
            <!-- Status bar -->
        </Grid.RowDefinitions>

        <!-- Header -->
        <DockPanel Grid.Row="0" Margin="16,12,16,8">
            <Label x:Name="lblChatTitle"
                   Content="{x:Static language:Lang.chatTittle}"
                   FontSize="20"
                   FontWeight="Bold"
                   HorizontalAlignment="Center"
                   DockPanel.Dock="Top"/>
        </DockPanel>

        <!-- Lista de mensajes -->
        <Border Grid.Row="1" Margin="16" BorderThickness="1">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <ListView x:Name="lvMessages"
                          ItemsSource="{Binding Messages}"
                          VirtualizingPanel.IsVirtualizing="True"
                          VirtualizingPanel.ScrollUnit="Pixel"
                          ScrollViewer.CanContentScroll="True"
                          BorderThickness="0">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Grid Margin="0,6">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="8"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Avatar opcional -->
                                <Image x:Name="imgAvatar"
                                       Width="24" Height="24"
                                       Source="{Binding AvatarPath}"
                                       Visibility="{Binding HasAvatar, Converter={StaticResource BooleanToVisibilityConverter}}"
                                       Stretch="UniformToFill"
                                       Margin="0,2,0,0"/>

                                <StackPanel Grid.Column="2">
                                    <TextBlock Text="{Binding Header}" 
                                               FontWeight="Bold"
                                               TextWrapping="NoWrap"/>
                                    <TextBlock Text="{Binding Text}"
                                               TextWrapping="Wrap"
                                               Margin="0,2,0,0"/>
                                </StackPanel>
                            </Grid>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </ScrollViewer>
        </Border>

        <!-- Input bar -->
        <Grid Grid.Row="2" Margin="16,0,16,8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="8"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="8"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Button x:Name="btnStickers"
                    Grid.Column="0"
                    Content="{x:Static language:Lang.lblStickersText}"
                    Command="{Binding OpenStickersCommand}"
                    Height="32" MinWidth="90"/>

            <TextBox x:Name="taMessage"
                     Grid.Column="2"
                     Text="{Binding NewMessage, UpdateSourceTrigger=PropertyChanged}"
                     AcceptsReturn="True"
                     TextWrapping="Wrap"
                     Height="48"
                     MaxLength="500"
                     ToolTip="Ctrl+Enter para enviar; Enter hace salto si lo dejas presionado."
                     >
                <!-- ✅ Atajo en el control para evitar conflictos -->
                <TextBox.InputBindings>
                    <KeyBinding Key="Enter" Modifiers="Control"
                                Command="{Binding SendMessageCommand}"/>
                </TextBox.InputBindings>
            </TextBox>

            <Button x:Name="btnSend"
                    Grid.Column="4"
                    Content="{x:Static language:Lang.btnSendText}" 
                Command="{Binding SendMessageCommand}"
                    Height="32" MinWidth="90"/>
        </Grid>

        <!-- Status bar -->
        <DockPanel Grid.Row="3" Margin="16,0,16,16">
            <CheckBox x:Name="cbAutoScroll"
                      Content="Auto-scroll"
                      IsChecked="{Binding IsAutoScrollEnabled}"
                      DockPanel.Dock="Left"/>
            <Label x:Name="lblStatus"
                   Content="{Binding StatusText}"
                   HorizontalAlignment="Right"
                   DockPanel.Dock="Right"/>
        </DockPanel>
    </Grid>

    <!-- ✅ Si aún quieres los atajos a nivel Page, ponlos AQUÍ (no dentro del Grid) -->
    <!--
    <Page.InputBindings>
        <KeyBinding Key="Enter" Modifiers="None" Command="{Binding SendMessageCommand}"/>
    </Page.InputBindings>
    -->
</Page>
