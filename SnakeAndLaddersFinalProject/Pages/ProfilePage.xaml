<Page x:Class="SnakeAndLaddersFinalProject.Pages.ProfilePage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:language="clr-namespace:SnakeAndLaddersFinalProject.Properties.Langs"
      Title="ProfilePage"
      Background="White"
      Loaded="PageLoaded">

    <Page.Resources>
        <!-- Lo puedes usar si luego quieres bindings a bool -> visibility -->
        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
    </Page.Resources>

    <Grid x:Name="rootGrid" Margin="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="Auto"/>
            <!-- Banner edición -->
            <RowDefinition Height="*"/>
            <!-- Contenido + botones con scroll -->
        </Grid.RowDefinitions>

        <!-- HEADER -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Botón back -->
            <Button x:Name="btnBack"
                    Grid.Column="0"
                    Width="80"
                    Height="80"
                    Background="Transparent"
                    BorderBrush="Transparent"
                    Cursor="Hand"
                    Click="BtnBack_Click">
                <Image Source="/Assets/Images/Icons/BackIcon.png"
                       Width="31"
                       Height="31"
                       Stretch="Fill"
                       RenderOptions.BitmapScalingMode="NearestNeighbor" />
            </Button>

            <!-- Título -->
            <TextBlock Grid.Column="1"
                       Text="{x:Static language:Lang.lblProfileTitle}"
                       FontSize="24"
                       FontWeight="SemiBold"
                       VerticalAlignment="Center" />

            <!-- Botón menú (3 rayitas) -->
            <Button x:Name="btnMenu"
                    Grid.Column="2"
                    Width="36"
                    Height="32"
                    Background="Transparent"
                    BorderBrush="Transparent"
                    Click="BtnMenu_Click"
                    Cursor="Hand">
                <StackPanel Orientation="Vertical"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                    <Rectangle Height="3" Width="22" RadiusX="1.5" RadiusY="1.5" Fill="Black" Margin="0,1"/>
                    <Rectangle Height="3" Width="22" RadiusX="1.5" RadiusY="1.5" Fill="Black" Margin="0,1"/>
                    <Rectangle Height="3" Width="22" RadiusX="1.5" RadiusY="1.5" Fill="Black" Margin="0,1"/>
                </StackPanel>

                <Button.ContextMenu>
                    <ContextMenu x:Name="cmAccountMenu">
                        <MenuItem x:Name="miEditAccount"
                                  Header="{x:Static language:Lang.menuEditAccountText}"
                                  Click="MenuEditAccount_Click" />
                        <MenuItem x:Name="miDeleteAccount"
                                  Header="{x:Static language:Lang.menuDeleteAccountText}"
                                  Click="MenuDeleteAccount_Click" />
                        <MenuItem x:Name="miViewStats"
                                  Header="{x:Static language:Lang.menuViewStatsText}"
                                  Click="MenuViewStats_Click" />
                    </ContextMenu>
                </Button.ContextMenu>
            </Button>
        </Grid>

        <!-- BANNER MODO EDICIÓN -->
        <Border x:Name="borderEditBanner"
                Grid.Row="1"
                Margin="0,12,0,0"
                Background="#FFFDE7"
                BorderBrush="#FFE0B2"
                BorderThickness="1"
                CornerRadius="6"
                Visibility="Collapsed">
            <TextBlock x:Name="txtEditBanner"
                       Margin="12,6"
                       Text="{x:Static language:Lang.lblProfileEditModeText}"
                       FontWeight="SemiBold"
                       Foreground="#FF8D6E00" />
        </Border>

        <!-- CONTENIDO + BOTONES CON SCROLL -->
        <ScrollViewer Grid.Row="2"
                      Margin="0,16,0,0"
                      VerticalScrollBarVisibility="Auto">
            <StackPanel>

                <!-- TARJETA PERFIL -->
                <Border x:Name="borderProfileCard"
                        Background="#FFFFFFFF"
                        BorderBrush="#FFDDDDDD"
                        BorderThickness="1"
                        CornerRadius="12"
                        Padding="24">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="32"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <!-- COLUMNA AVATAR -->
                        <StackPanel Grid.Column="0"
                                    Width="220"
                                    HorizontalAlignment="Left">
                            <Ellipse Width="160"
                                     Height="160"
                                     HorizontalAlignment="Center"
                                     VerticalAlignment="Center"
                                     Stroke="#FFCCCCCC"
                                     StrokeThickness="2">
                                <Ellipse.Fill>
                                    <ImageBrush ImageSource="{Binding AvatarId,
                                                                      Converter={StaticResource AvatarIdToPathConverter},
                                                                      FallbackValue=/Assets/Images/Icons/A0013.jpg,
                                                                      TargetNullValue=/Assets/Images/Icons/A0013.jpg}"
                                                Stretch="UniformToFill" />
                                </Ellipse.Fill>
                            </Ellipse>

                            <Button x:Name="btnChangeAvatar"
                                    Margin="0,16,0,0"
                                    Height="32"
                                    Width="160"
                                    HorizontalAlignment="Center"
                                    Content="{x:Static language:Lang.btnChangeAvatarText}"
                                    Click="BtnChangeAvatar_Click" Background="#FFD0E9DA" />
                        </StackPanel>

                        <!-- COLUMNA DATOS -->
                        <Grid Grid.Column="2">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="8"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- Username grande -->
                            <StackPanel Grid.Row="0" Orientation="Vertical">
                                <TextBlock Text="{x:Static language:Lang.lblProfileUserNameCaptionText}"
                                           FontSize="12"
                                           Foreground="#99000000"/>
                                <TextBlock x:Name="txtUsername"
                                           FontSize="20"
                                           FontWeight="SemiBold"
                                           Margin="0,2,0,0" />
                            </StackPanel>

                            <!-- Nombre -->
                            <Grid Grid.Row="2" Margin="0,8,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="160"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="{x:Static language:Lang.txtNameOfUserText}"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <TextBox x:Name="txtFirstName"
                                         Grid.Column="1"
                                         Margin="0,0,0,4"
                                         IsReadOnly="True" />
                            </Grid>

                            <!-- Apellidos -->
                            <Grid Grid.Row="3" Margin="0,4,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="160"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="{x:Static language:Lang.lblProfileLastNameText}"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <TextBox x:Name="txtLastName"
                                         Grid.Column="1"
                                         Margin="0,0,0,4"
                                         IsReadOnly="True" />
                            </Grid>

                            <!-- Descripción -->
                            <Grid Grid.Row="4" Margin="0,4,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="160"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="{x:Static language:Lang.lblProfileDescriptionText}"
                                           VerticalAlignment="Top"
                                           Margin="0,2,8,0"/>
                                <TextBox x:Name="txtDescription"
                                         Grid.Column="1"
                                         Margin="0,0,0,4"
                                         IsReadOnly="True"
                                         Height="80"
                                         TextWrapping="Wrap"
                                         AcceptsReturn="True"
                                         VerticalScrollBarVisibility="Auto" />
                            </Grid>

                            <!-- Monedas (solo lectura) -->
                            <Grid Grid.Row="5" Margin="0,4,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="160"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <TextBlock Text="{x:Static language:Lang.lblCoinsText}"
                                           VerticalAlignment="Center"
                                           Margin="0,0,8,0"/>
                                <TextBox x:Name="txtCoins"
                                         Grid.Column="1"
                                         Margin="0,0,0,4"
                                         IsReadOnly="True" />
                            </Grid>
                        </Grid>
                    </Grid>
                </Border>

                <!-- BOTONES INFERIORES -->
                <StackPanel Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            Margin="0,16,0,0">
                    <Button x:Name="btnGuardar"
                            Content="{x:Static language:Lang.btnProfileSaveText}"
                            Width="90"
                            Margin="0,0,8,0"
                            Click="BtnGuardar_Click"
                            IsEnabled="False" Background="#FFD0E9DA" />
                    <Button x:Name="btnCancelar"
                            Content="{x:Static language:Lang.btnCancelText}"
                            Width="90"
                            Click="BtnCancelar_Click"
                            IsEnabled="False" Background="#FFF9C7D7" />
                </StackPanel>

            </StackPanel>
        </ScrollViewer>

        <!-- PICKER DE AVATARES flotante -->
        <Border x:Name="borderAvatarPicker"
                Grid.Row="2"
                Panel.ZIndex="20"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Margin="0,24,0,0"
                Width="380"
                Background="White"
                BorderBrush="#FFDDDDDD"
                BorderThickness="1"
                CornerRadius="10"
                Padding="12"
                Visibility="Collapsed">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="8"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Título + cerrar -->
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Text="{x:Static language:Lang.lblSelectAvatarTitleText}"
                               FontWeight="SemiBold"
                               VerticalAlignment="Center"/>

                    <Button Grid.Column="1"
                            Width="24"
                            Height="24"
                            Margin="4,0,0,0"
                            Background="Transparent"
                            BorderBrush="Transparent"
                            Cursor="Hand"
                            Click="BtnCloseAvatarPicker_Click">
                        <TextBlock Text="✕"
                                   FontSize="14"
                                   VerticalAlignment="Center"
                                   HorizontalAlignment="Center"/>
                    </Button>
                </Grid>

                <!-- Lista de avatares -->
                <ScrollViewer Grid.Row="2"
                              VerticalScrollBarVisibility="Auto">
                    <ItemsControl x:Name="avatarItemsControl">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Orientation="Horizontal"
                                           ItemWidth="80"
                                           ItemHeight="80"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>

                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Width="72"
                                        Height="72"
                                        Margin="4"
                                        Tag="{Binding}"
                                        Click="AvatarItem_Click"
                                        Background="Transparent"
                                        BorderBrush="Transparent"
                                        Cursor="Hand">
                                    <Border CornerRadius="8"
                                            BorderThickness="1"
                                            BorderBrush="#FFCCCCCC"
                                            Padding="4">
                                        <Image Source="{Binding Converter={StaticResource AvatarIdToPathConverter}}"
                                               Stretch="UniformToFill"
                                               RenderOptions.BitmapScalingMode="NearestNeighbor"/>
                                    </Border>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

            </Grid>
        </Border>

    </Grid>
</Page>
